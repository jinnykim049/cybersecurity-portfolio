# Run Snort in IDS/IPS Mode. 
IDS/IPS mode helps managing the traffic according to user-defined rules.

Note: (N)IDS/IPS mode depends on the rules and configuration. 



## PARAMETERS 
-------------------------------------------------------
-c: Defining the configuration file. 
-T: Testing the configuration file. 
-N: Disable logging. 
-D: Background mode. 

-A: Alert modes;
full: Full alert mode, providing all possible information about the alert. This is the default mode. 
fast: Shows the alert message, timestamp, source and destination IP, along with port numbers.
console: Provides fast style alerts on the console screen.
cmg: CMG style, basic header details with payload in hex and text format.
none: Disabling alerting.


------------------------------------------------------- 


Below is more details about the parameters. 

and this is the information that I need to know before diving in to that: 

For active traffic in my interface, I first need to run the traffic-generator script and sniff. 

After running IDS/IPS mode, 1. I need to use rules. As mentioned earlier, I will use a pre-defined ICMP rule as an example. 
The defined rule will only generate alerts in any direction of ICMP packet activity.

"alert icmp any any <> any any  (msg: "ICMP Packet Found"; sid: 100001; rev:1;)" 

This rule is located in "/etc/snort/rules/local.rules".

Remember, in this module, I will focus only on the operating modes. 
Snort will create an "alert" file if the traffic flow triggers an alert. 

Once I start running IDS/IPS mode, 2. the sniffing and logging mode will be semi-passive. However, I can activate the functions using the parameters discussed in previous tasks. (-i, -v, -d, -e, -X, -l, -K ASCII) 



* PARAMETERS- 
# 1. IDS/IPS mode with parameter "-c and -T" 
: checks a configuration file and prompt it if there is any misconfiguratioın in the current setting.  

"sudo snort -c /etc/snort/snort.conf -T"

# 2. IDS/IPS mode with parameter "-N" 
: Start the Snort instance and disable logging mode. The rest of the other functions will still be available (if activated).
That means, verbosity (-v) or full packet dump (-X) can be activated and I can still have the output in the console. (But there will be no logs in the log folder.) 

"sudo snort -c /etc/snort/snort.conf -N" 

# 3. IDS/IPS mode with parameter "-D" 
: Snort instance in background mode 

"sudo snort -c /etc/snort/snort.conf -D" 

Once the traffic is generated with ICMP/HTTP traffic, snort will start processing the packets and accomplish the given task with additional parameters. 

For example, I could see this: 
----------------------------------------
$ sudo snort -c /etc/snort/snort.conf -D

Spawning daemon child...
My daemon child 2898 lives...
Daemon parent exiting (0) 
----------------------------------------

If I activate verbosity (-v) or full packet dump (-X) with packet logger mode (-l) I will still have the logs in the logs folder, but there will be no output in the console. (Opposoite to -N). 

Once I start the background mode and want to check the corresponding process, I can easily use the "ps" command as shown below;

----------------------------------------
$ ps -ef | grep snort

root        2898    1706  0 05:53 ?        00:00:00 snort -c /etc/snort/snort.conf -D 
----------------------------------------

I can kill this command using "sudo kill -9 2898". 

* Note: daemon mode is mainly used to automate the Snort. This parameter is mainly used in scripts to start the Snort service in the background. It is not recommended to use this mode unless the user have a working knowledge of Snort and stable configuration.



# 4. IDS/IPS mode with parameter "-A"
There are console, cmg, full, fast, none modes with this alert mode. 
Only the "console" and "cmg" parameters provide alert information in the console. It is impossible to identify the difference between the rest of the alert modes via terminal. 
Differences can be identified by looking at generated logs.  

# 4.1. -A console: 
This mode provides fast style alerts on the console screen.
"sudo snort -c /etc/snort/snort.conf -A console". 

Start the ICMP/HTTP traffic, and run the command. This is what I would see: 
----------------------------------------
$ sudo snort -c /etc/snort/snort.conf -A console
Running in IDS mode

----------------------------------------
        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3743)
12/12-02:08:27.577495  [**] [1:366:7] ICMP PING *NIX [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:27.577495  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:27.577495  [**] [1:384:5] ICMP PING [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:27.609719  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
^C*** Caught Int-Signal
12/12-02:08:29.595898  [**] [1:366:7] ICMP PING *NIX [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:29.595898  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:08:29.595898  [**] [1:384:5] ICMP PING [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
===============================================================================
Run time for packet processing was 26.25844 seconds
Snort processed 88 packets. 

----------------------------------------







# 4.2. -A cmg: 
This mode provides basic header details with payload in hex and text format.  

Start the ICMP/HTTP traffic, and run the command. This is what I would see: 

----------------------------------------
$ sudo snort -c /etc/snort/snort.conf -A cmg
Running in IDS mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3743)
12/12-02:23:56.944351  [**] [1:366:7] ICMP PING *NIX [**] [Classification: Misc activity] [Priority: 3] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-02:23:56.944351 00:0C:29:A5:B7:A2 -> 00:50:56:E1:9B:9D type:0x800 len:0x62
192.168.175.129 -> 142.250.187.110 ICMP TTL:64 TOS:0x0 ID:10393 IpLen:20 DgmLen:84 DF
Type:8  Code:0  ID:4   Seq:1  ECHO
BC CD B5 61 00 00 00 00 CE 68 0E 00 00 00 00 00  ...a.....h......
10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F  ................
20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F   !"#$%&'()*+,-./
30 31 32 33 34 35 36 37                          01234567

 
----------------------------------------
 

* Brief Summary (4.1&4.2): 
4.1. console mode- provides basic header and rule information. 
4.2. Cmg mode- provides full packet details along with rule information. 



# 4.3. -A fast:  
provides alert messages, timestamps, and source and destination IP addresses. Remember, there is no console output in this mode.  

"sudo snort -c /etc/snort/snort.conf -A fast"

Start the ICMP/HTTP traffic, and run the command. This is what I would see: 

---------------------------------------- 
$ sudo snort -c /etc/snort/snort.conf -A fast
Running in IDS mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3743)
----------------------------------------  
Check the alarm file. View the image:
(Screenshots/Network Security and Traffic Analysis/02/2.7/Screenshot 2025-07-20 at 3.49.00 PM.png)

=> Fast style alerts contain summary information on the action like direction and alert header.


# 4.4 -A full :
Provides all possible information about the alert. Remember, there is no console output in this mode. 

"sudo snort -c /etc/snort/snort.conf -A full"

Start the ICMP/HTTP traffic, and run the command. This is what I would see:  

----------------------------------------  
$ sudo snort -c /etc/snort/snort.conf -A full
Running in IDS mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3744)


----------------------------------------  
Check the alarm file. View the image: 
(Screenshots/Network Security and Traffic Analysis/02/2.7/Screenshot 2025-07-20 at 3.51.49 PM.png)

=> Full style alerts contain all possible information on the action. 


# 4.5 -A none: 
Disable alerting. This mode doesn't create the alert file. However, it still logs the traffic and creates a log file in binary dump format. Remember, there is no console output in this mode. 

"sudo snort -c /etc/snort/snort.conf -A none"

Start the ICMP/HTTP traffic, and run the command. This is what I would see: 

---------------------------------------- 
$ sudo snort -c /etc/snort/snort.conf -A none
Running in IDS mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Initializing Preprocessors!
Initializing Plug-ins!
Parsing Rules file "/etc/snort/snort.conf"
...
Commencing packet processing (pid=3745)
----------------------------------------  



### IDS/IPS mode: "Using rule file without configuration file"  ### 
It is possible to run the Snort only with rules without a configuration file. Running the Snort in this mode will help testing the user-created rules. (However, this mode will provide less performance.) 

For example, 
----------------------------------------
$ sudo snort -c /etc/snort/rules/local.rules -A console
Running in IDS mode

12/12-12:13:29.167955  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:29.200543  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:30.169785  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
12/12-12:13:30.201470  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 142.250.187.110 -> 192.168.175.129
12/12-12:13:31.172101  [**] [1:10000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.129 -> 142.250.187.110
^C*** Caught Int-Signal
 ---------------------------------------- 


 ### IPS mode and dropping packets ###
Snort IPS mode activated with "-Q --daq afpacket" parameters. 

It is possible to activate this mode by editing snort.conf file, but its not necessary at this point. 

I could activate the Data Acquisition (DAQ) modules and use the afpacket module to use snort as an IPS: -i eth0:eth1 

To identify interfaces, Snort IPS require at least two interfaces to work. 
Now run the traffic-generator script as sudo and start ICMP/HTTP traffic. This is what I would see: 

 ---------------------------------------- 
$ sudo snort -c /etc/snort/snort.conf -q -Q --daq afpacket -i eth0:eth1 -A console
Running in IPS mode

12/18-07:40:01.527100  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.131 -> 192.168.175.2
12/18-07:40:01.552811  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 172.217.169.142 -> 192.168.1.18
12/18-07:40:01.566232  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.175.131 -> 192.168.175.2
12/18-07:40:02.517903  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 192.168.1.18 -> 172.217.169.142
12/18-07:40:02.550844  [Drop] [**] [1:1000001:0] ICMP Packet found [**] [Priority: 0] {ICMP} 172.217.169.142 -> 192.168.1.18
^C*** Caught Int-Signal
 ----------------------------------------  

=> Snort blocked the packets this time. We used the same rule with a different action (drop/reject). Remember, for the scope of this task; the point is the operating mode, not the rule. 


## LAB 
Investigate the traffic with the default configuration file.
Execute the traffic generator script and choose "TASK-7 Exercise". Wait until the traffic stops, then stop the Snort instance. Now analyse the output summary and answer the question.
 

Q1. What is the number of the detected HTTP GET methods? 
A1. I first 

* Here is what I did: 
1. I first ran this command "sudo snort -c /etc/snort/snort.conf -A full -l ." in a terminal at ~/Desktop/Task-Exercises/Exercise-Files and minimized it. 

2. I opened a new terminal and ran the traffic generator script than clicked “TASK-7 Exercise.”
(View image: Screenshots/Network Security and Traffic Analysis/02/2.7/Screenshot 2025-07-20 at 4.15.12 PM.png)

3. I went back to the first terminal that I minimized and pressed control + c. 

4. Then scrolled down to find the number of HTTP GET methods. 
(View image: Screenshots/Network Security and Traffic Analysis/02/2.7/Screenshot 2025-07-20 at 4.20.44 PM.png)

During this lab, I made sure to start sniffing before the attack and terminate right after the attack. 



## From this lab, I learned..  
1. How to run Snort in IDS/IPS mode and test configurations
I learned that I can start Snort in IDS/IPS mode using -c to specify the config file and -T to test it. The test helps catch syntax or path issues before launching Snort, which saves time and avoids confusion later.
2. Different alert output modes and their use cases
Snort can show alerts in several ways using -A. I used console to see alerts directly in the terminal, and cmg to get detailed packet data in hex and ASCII. Modes like fast and full write logs to files instead, which is useful for large captures.
3. How Snort behaves in background or no-logging mode
Using -D, I can run Snort in the background, which is useful for automation or longer tasks. With -N, Snort won’t write log files, but it still shows traffic on the screen if other flags like -v or -X are used. It’s important to know the effect of each mode on visibility and log storage.
4. Snort can run without a full config file
I was surprised that I could run Snort with just a rule file instead of the full config. This is handy when testing new or custom rules without loading unnecessary modules.
5. Snort can be used as an IPS with -Q and DAQ modules. 
When I added -Q --daq afpacket -i eth0:eth1, Snort switched to IPS mode and dropped packets. It made me realize Snort can actively protect a system, not just detect threats.
