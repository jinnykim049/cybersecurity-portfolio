## Run Snort in Logger Mode
: Snort can be used as a sniffer and log the sigged packets via logger mode. 
I only need the packet logger mode parameters, and Snort does the rest to accomplish it. 

## PARAMETERS 
-------------------------------------------------------
-l: Logger mode, target log and alert output directory. Default output folder is /var/log/snort. The default action is to dump as tcpdump format in /var/log/snort
-K ASCII: Log packets in ASCII format.
-r: Reading option, read the dumped logs in Snort. 
-n: Specify the number of packets that will process/read. Snort will stop after reading the specified number of packets. 
-------------------------------------------------------

Below is more details about the parameters. 

*Note: Remember the Linux file ownership and permissions. "whoever creates a file becomes the owner of the corresponing file." 

RIGHTS- 
Snort needs superuser rights to sniff the traffic, so you will need "root" rights to investigate the log files. There are two different approaches to investigate the generated log files; 
1. Elevation of privileges - Use the "sudo command" to execute command. I can also elevate the session privileges and switch to the superuser account to examine the generated log files. "sudo su"

2. Changing the ownership of files/directories - Read file/folder as the user: "sudo chown username file" or "sudo chown username -R directory" The "-R" parameter helps recursively process the files and directories. 


* PARAMETERS- 
# 1. Logging with parameter "-l" 
Start the Snort instance in packet logger mode. "sudo snort -dev -l"
Then start ICMP/HTTP traffic with the traffic-generator script. 

Once the traffic is generated, Snort will start showing the packets and log them in the target directory. The default output directory is snort.config file. (However, "-l" parameter can set a target directory.) 

* Identifying the default log directory is useful for continuous monitoring operations, and the "-l" parameter is much more useful for testing purposes.

The -l . part of the command creates the logs in the current directory. I need to use this option to have the logs for each exercise in their folder. 

This is what I could see from it: 

-------------------------------------------------------
$ sudo snort -dev -l .
                             

Running in packet logging mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Log directory = /var/log/snort
pcap DAQ configured to passive.
Acquiring network traffic from "ens33".
Decoding Ethernet

        --== Initialization Complete ==--
...
Commencing packet processing (pid=2679)
WARNING: No preprocessors configured for policy 0.
WARNING: No preprocessors configured for policy 0. 

-------------------------------------------------------

Then, It generates the log file. It is a single all-in-one log file. and a binary/tcpdump format log. 


# 2. Logging with parameter "-K ASCII" 
Start the Snort instance in packet logger mode; sudo snort -dev -K ASCII

Now run the traffic-generator script as sudo and start ICMP/HTTP traffic. Once the traffic is generated, Snort will start showing the  packets in verbosity mode as follows: 


-------------------------------------------------------
$ sudo snort -dev -K ASCII -l .
                             
Running in packet logging mode

        --== Initializing Snort ==--
Initializing Output Plugins!
Log directory = /var/log/snort
pcap DAQ configured to passive.
Acquiring network traffic from "ens33".
Decoding Ethernet

        --== Initialization Complete ==--
...
Commencing packet processing (pid=2679)
WARNING: No preprocessors configured for policy 0.
WARNING: No preprocessors configured for policy 0. 

-------------------------------------------------------

The logs created with "-K ASCII" parameter is entirely different. There are two folders with IP address names.  
Once we look closer at the created folders, we can see that the logs are in ASCII and categorised format, so it is possible to read them without using a Snort instance. 

## ASCII Mode 
ASCII mode provides multiple files in human-readable format, so it is possible to read the logs easily by using a text editor. By contrast with ASCII format, binary format is not human-readable and requires analysis using Snort or an application like tcpdump.


# 3. Reading generated logs with parameter "-r" 

Start the Snort instance in packet reader mode; sudo snort -r

This is what I could see from it: 

-------------------------------------------------------
$ sudo snort -r snort.log.1638459842
                             
Running in packet dump mode

        --== Initializing Snort ==--
Initializing Output Plugins!
pcap DAQ configured to read-file.
Acquiring network traffic from "snort.log.1638459842".

        --== Initialization Complete ==--
...
Commencing packet processing (pid=3012)
WARNING: No preprocessors configured for policy 0.
12/02-07:44:03.123225 192.168.175.129 -> 142.250.187.110
ICMP TTL:64 TOS:0x0 ID:41900 IpLen:20 DgmLen:84 DF
Type:8  Code:0  ID:1   Seq:49  ECHO
=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
WARNING: No preprocessors configured for policy 0.
12/02-07:44:26.169620 192.168.175.129 -> 142.250.187.110
ICMP TTL:64 TOS:0x0 ID:44765 IpLen:20 DgmLen:84 DF
Type:8  Code:0  ID:1   Seq:72  ECHO
===============================================================================
Packet I/O Totals:
   Received:           51
   Analyzed:           51 (100.000%)
    Dropped:            0 (  0.000%)
   Filtered:            0 (  0.000%)
Outstanding:            0 (  0.000%)
   Injected:            0
===============================================================================
Breakdown by protocol (includes rebuilt packets):
...
      Total:           51
===============================================================================
Snort exiting
-------------------------------------------------------



* Note: Snort can read and handle the binary like output (tcpdump and Wireshark also can handle this log format). However, if I create logs with "-K ASCII" parameter, Snort will not read them.  


- Opening log file with tcpdump.
-------------------------------------------------------
$ sudo tcpdump -r snort.log.1638459842 -ntc 10
                             
reading from file snort.log.1638459842, link-type EN10MB (Ethernet)
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 49, length 64
IP 142.250.187.110 > 192.168.175.129: ICMP echo reply, id 1, seq 49, length 64
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 50, length 64
IP 142.250.187.110 > 192.168.175.129: ICMP echo reply, id 1, seq 50, length 64
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 51, length 64
IP 142.250.187.110 > 192.168.175.129: ICMP echo reply, id 1, seq 51, length 64
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 52, length 64
IP 142.250.187.110 > 192.168.175.129: ICMP echo reply, id 1, seq 52, length 64
IP 192.168.175.1.63096 > 239.255.255.250.1900: UDP, length 173
IP 192.168.175.129 > 142.250.187.110: ICMP echo request, id 1, seq 53, length 64
-------------------------------------------------------

- Opening log file with Wireshark. 
(View Image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 1.14.26 PM.png)



## -r PARAMETER 
"-r" parameter (and and Berkeley Packet Filters (BPF)) allows users to filter the binary log files.  

sudo snort -r logname.log -X
sudo snort -r logname.log icmp
sudo snort -r logname.log tcp
sudo snort -r logname.log 'udp and port 53'

The output will be the same as the above, but only packets with the chosen protocol will be shown. 
Additionally, I can specify the number of processes with the parameter "-n". 
For example, this following command will process only the first 10 packets: snort -dvr logname.log -n 10 


* Read these to understand how the BPF works and its use.
https://en.wikipedia.org/wiki/Berkeley_Packet_Filter 
https://biot.com/capstats/bpf.html
https://www.tcpdump.org/manpages/tcpdump.1.html



## LAB 
: Investigate the traffic with the default configuration file with ASCII mode.  
Execute the traffic generator script and choose "TASK-6 Exercise". 
Wait until the traffic ends, then stop the Snort instance. 
Now analyse the output summary and answer the question. Now, you should have the logs in the current directory. Navigate to folder "145.254.160.237".

Q1. What is the source port used to connect port 53?
A1. 3009 

* Here is what I did: 
1. Ran "~/Desktop/Task-Exercises$ sudo snort -dev -K ASCII -l. "
(View image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 1.33.04 PM.png)

2. Minimized the tab, and at the same time, execute the traffic generator script and choose "TASK-6 Exercise".  
(View image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 1.48.16 PM.png)

3. Waited until the traffic ended, then went back to the first terminal (that I minimized) and pressed control + C.

(View image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 1.50.56 PM.png)

4. I navigated to folder "145.254.160.237". However, I couldn't acccess the file due to the permission issue. 

(View image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 1.54.04 PM.png)

Therefore, I had to change the permission

5. I ran "~/Desktop/Task-Exercises$ sudo chmod 777 145.254.160.237 " first, then ran "cd 145.254.160.237"

*Note: 777 gives read + write + execute permissions to everyone (owner, group, others).
However,.. this command is risky because it gives  everyone full access, making the file vulnerable to misuse, hacking, or accidental damage. I could use it because it was a virtual machine.  


(View image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 2.02.21 PM.png)

6. I could see that the source port used to connect port 53 was 3009. 



Q2. Use snort.log.1640048004
Read the snort.log file with Snort; what is the IP ID of the 10th packet? 
A2. 

* Here is what I did: 
1. Navigated to TASK-6 in terminal and ran "sudo snort -r snort.log.1640048004 -n 10"

(View image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 2.14.03 PM.png)


2. Scrolled down and found the last packet's (10th packet) IP ID. 

(View image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 2.15.07 PM.png)



Q3. Read the "snort.log.1640048004" file with Snort; what is the referer of the 4th packet?
A3. http://www.ethereal.com/development.html

* Here is what I did: 
1. Navigated to TASK-6 in terminal and ran "sudo snort -r snort.log.1640048004 -n 4 -X". I added -X to the command to view the full packet details. 

(View Image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 2.31.31 PM.png)

2. Then Scrolled down to find the fourth (the last) packet information and its referer. 

(View: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 2.34.02 PM.png)
  

Q4. Read the "snort.log.1640048004" file with Snort; what is the Ack number of the 8th packet? 
A4. 
A4. 0x38AFFFF3 

* Here is what I did: 
1. Navigated to ../TASK-6 and ran "sudo snort -r snort.log.1640048004 -n 8 -v". 

Note: I added -v to display the packer headers (TCP/IP) in the console. I knew that ACK number (Acknowledgment Number) is a field in the TCP header that tells the sender that it successfully received all data up to this number.

2. Went to the last (8th) packet's details and checked Ack number. 
(View image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 2.45.40 PM.png)


Q5. Read the "snort.log.1640048004" file with Snort; what is the number of the "TCP port 80" packets? 
A. 

* Here is what I did: 
1. Navigated to TASK-6 in terminal and ran "sudo snort -r snort.log.1640048004 'tcp and port 80'" 

Note: 'tcp and port 80' -> This is a Berkeley Packet Filter (BPF) expression. It filters for TCP packets that are either source or destination port 80. 


2. Then I found that the total number of the "TCP port 80 packets" is 41. 
(View image: Screenshots/Network Security and Traffic Analysis/02/2.6/Screenshot 2025-07-20 at 2.49.50 PM.png)



## From this lab, I learned.. 
1. How to run Snort in logger mode and use its options using parameters. 
I learned Snort can log packets using -l to set the log folder, and -K ASCII to save logs in an easy-to-read text format. It’s cool that I can choose between binary and ASCII logs depending on what I need.

2. The importance of root permissions and file ownership
I faced permission issues when accessing log folders, so I had to use commands like chmod and chown. This made me realize how important Linux file permissions are when working with network tools like Snort.

3. Logs can be analyzed with other tools like tcpdump and Wireshark. 
Snort’s binary logs can be opened with tcpdump or Wireshark, which gives me more flexibility for analysis.
Using Berkeley Packet Filters (BPF) to filter packets
I found it useful that I can filter logs by protocol or port using BPF expressions, like showing only TCP packets on port 80. It helps focus on what matters. 



