2.1 Inspecting_Credential_Hash

**Objective**
Verify that Kerberos authentication traffic contains credential hashes that could be captured or exploited during adversary-in-the-middle attacks. 

* Kerberos authentication: a secure network authentication protocol that uses secret-key cryptography and a trusted third party (called the Key Distribution Center, KDC) to verify the identity of users and services in a network.

It is widely used in Windows Active Directory environments for single sign-on (SSO) and mutual authentication between clients and servers. 


# Step 1:  Open the cap file with Wireshark
I used the 'krb-816.cap' file to analyze Kerberos authentication traffic. (More information about the file in Personal Projects/Credential Threat Detection & DNS Tunneling Analysis (Wireshark + MITRE)/01. Data/ReadMe.md)

After downloading and opening the file using Wireshark, I saw several packets related to UDP traffic on port 88, which is typically used for Kerberos. 

(View image after opening the file using Wireshark: Personal Projects/Credential Threat Detection & DNS Tunneling Analysis (Wireshark + MITRE)/Appendix/Screenshots/Screenshot 2025-08-05 at 8.16.05 PM.png). 

# Step 2: Apply Display Filter to View Kerberos Authentication
To isolate only Kerberos authentication packets, I applied the following display filter below.

**Filter used:** 
kerberos
 

-> 
This filter shows all Kerberos-related packets, including:
-Authentication Service Request (AS-REQ)
-Ticket Granting Service Request (TGS-REQ)
-Pre-authentication data 

(View image after applying the filter: Personal Projects/Credential Threat Detection & DNS Tunneling Analysis (Wireshark + MITRE)/Appendix/Screenshots/Screenshot 2025-08-05 at 8.19.35 PM.png )


#  Step 3: Inspect Pre-Authentication Data
Among the filtered packets, I found one of packets labeled KRB5 AS-REQ (Authentication Request) and clicked on it. 
Then WireShark revealed me a section labeled: 'PA-DATA: PA-ENC-TIMESTAMP'
(View image - See the highlighted part: Personal Projects/Credential Threat Detection & DNS Tunneling Analysis (Wireshark + MITRE)/Appendix/Screenshots/Screenshot 2025-08-05 at 8.25.43 PM.png)
 

The highlighted data is a Kerberos's encrypted timestamp used in pre-authentication. It represents a point of credential exposure over the network, where attackers can capture the encrypted blob and attempt to crack the user password offline (if they know username). 

It is possible even though it's encrypted because.. 
- Encrypted blob is reproducible, which mean it’s always derived from the same password.
- An attacker can capture this blob using packet sniffing tools like Wireshark just like how I did.
-If the attacker knows the username, they can run offline brute-force/dictionary attacks to guess the password. For example, they
try a guess -> derive the key -> try decrypting the blob ->  check for valid timestamp structure.


To sum up, an attacker who captures it can attempt offline password cracking using the intercepted blob.
Therefore, it is absolutely a credential exposure point, and part of Kerberos pre-auth attack surface. 

 

- In the real world:
Red Teamers and APT groups capture these encrypted timestamps and try to crack them using tools like Kerberoast, Hashcat, or custom scripts. 
This is especially effective in environments with weak passwords or offline attacks 



# Step 4: Analyze
This kind of credential hash transmission is highly relevant to real-world attacks where adversaries:
- Intercept Kerberos authentication attempts
- Extract pre-authentication data (encrypted timestamp or ticket)
- Use it in brute-force password cracking attacks

This attack behavior maps directly to MITRE ATT&CK Technique ID T1557 (Adversary-in-the-Middle) and 
T1003.004 (LSASS Memory – Kerberos Tickets)	 

 