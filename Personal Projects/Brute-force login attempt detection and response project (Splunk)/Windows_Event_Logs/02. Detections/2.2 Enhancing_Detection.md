# Step 4: Enhancing Detection with Geolocation Enrichment 
To better understand the origin of the brute-force attempts, I enriched the data with geolocation information (City, Country, Region, etc.) using the iplocation command in Splunk.

I added this below to the query (from Step 3) 
"| iplocation SourceIP
| fillnull value="N/A" City Country Region lat lon"

So final SPL Query with GeoIP enrichment:
**SPL Query to detect Brute-Force attacks (with GeoIP enrichment)** 
source="sample_windows_event_log.json" host="Jinnys-MacBook-Pro.local" index="splunk_project_index" sourcetype="_json"
| spath
| search EventID=4625
| rex field=Message "(?s)Account For Which Logon Failed:.*?Account Name:\t(?<AccountName>[^\r\n]+)"
| rex field=Message "Source Network Address:\t(?<SourceIP>\S+)"
| rex field=Message "Logon Type:\t+(?<LogonType>\d+)"
| where LogonType == "3"
| iplocation SourceIP
| fillnull value="N/A" City Country Region lat lon
| stats count by SourceIP, AccountName, City, Country, Region, lat, lon
| sort -count
 

After running this query, I got this result below: 
(Personal Projects/Brute-force login attempt detection and response project (Splunk)/Windows_Event_Logs/Appendix/Screenshots/Screenshot 2025-08-03 at 9.25.27 PM.png)


From here, I found the limitation of my dataset. 
I noticed that all geolocation fields (City, Country, Region, etc.) returned as N/A for every SourceIP.
This is because Splunk’s iplocation command relies on an internal GeoIP database (such as MaxMind) to map real, public IP addresses to physical locations.

However, the dataset I used is fully synthetic and AI-generated. The SourceIP addresses in it fall into one of the following categories:
1. Reserved for documentation (e.g., 203.0.113.x) - used for tutorials or test scenarios, not assigned to any real-world location.
2. Non-routable/internal IPs (e.g., 192.168.x.x, 10.x.x.x) — used within private networks and never routed on the public internet.
3. Random/generated IPs — that do not exist in the real world and therefore have no entry in the GeoIP database.

Thus, iplocation couldn't resolve any of these IPs to real-world geographic info, resulting in all N/A values. 

Here is a solution for future work to enable meaningful geolocation enrichment. 
The dataset should include valid external IP addresses, such as those seen in real-world brute-force attempts. These could be obtained from threat intelligence feeds (e.g., AbuseIPDB, AlienVault OTX), Public datasets from incident response labs, Masked or obfuscated logs from controlled environments, or generated using AI models trained on real-world IP behavior patterns.. etc. 
 